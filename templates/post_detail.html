<!DOCTYPE html>
<html>
<head>
    <title>{{ post.title }} - 我的博客</title>
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-glass: rgba(255, 255, 255, 0.05);
            --bg-glass-hover: rgba(255, 255, 255, 0.1);
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --accent: #6366f1;
            --accent-hover: #4f46e5;
            --border: rgba(255, 255, 255, 0.1);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --shadow-hover: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0f0f23 100%);
            line-height: 1.6;
            color: var(--text-primary);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(59, 130, 246, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            padding: 3rem;
            border-radius: 20px;
            box-shadow: var(--shadow);
            overflow-wrap: break-word;
            transition: all 0.3s ease;
        }

        .container:hover {
            box-shadow: var(--shadow-hover);
        }
        h1 {
            color: var(--text-primary);
            text-align: left;
            margin-bottom: 2rem;
            word-break: break-word;
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1.2;
        }
        .post-content {
            color: var(--text-primary);
            font-size: 1.1rem;
            line-height: 1.8;
        }
        .post-images {
            margin-bottom: 2rem;
            text-align: center;
        }
        .post-detail-image {
            max-width: 100%;
            height: auto;
            margin: 1rem 0;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }

        .post-detail-image:hover {
            transform: scale(1.02);
        }

        .post-content p {
            margin-bottom: 1.5rem;
        }

        .post-content a {
            color: var(--accent);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .post-content a:hover {
            color: var(--accent-hover);
            text-decoration: underline;
        }
        .admin-actions {
            text-align: center;
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .edit-button {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-hover) 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .edit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
        }

        .admin-actions button {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .admin-actions button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(225, 29, 72, 0.3);
        }
        .back-link {
            display: inline-block;
            margin-top: 2rem;
            color: var(--accent);
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            background: var(--bg-glass);
            border: 1px solid var(--border);
            border-radius: 12px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .back-link:hover {
            color: var(--accent-hover);
            background: var(--bg-glass-hover);
            transform: translateY(-2px);
        }
        .post-content .parsed-link {
            color: var(--accent);
            text-decoration: underline;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .post-content .parsed-link:hover {
            color: var(--accent-hover);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>{{ post.title }}</h1>
        {# 显示所有图片 #}
        {% if post.image_urls %}
            <div class="post-images">
                {% for image_url in post.image_urls %}
                    <img src="{{ image_url }}" alt="文章图片" class="post-detail-image">
                {% endfor %}
            </div>
        {% endif %}
        <div class="post-content">
            {{ post.content | safe }}
        </div>

        {% if user == 'admin' %}
        <div class="admin-actions">
            <a href="{{ url_for('edit_post', post_id=post_id) }}" class="edit-button">{{ text.edit_post }}</a>
            <button onclick="deletePost('{{ post_id }}')">{{ text.delete_post }}</button>
        </div>
        {% endif %}

        <a href="{{ url_for('index') }}" class="back-link">{{ text.back_home }}</a>
    </div>
    <script>
        const postId = '{{ post_id }}'; // 将post_id赋值给JavaScript变量
        const indexUrl = '{{ url_for("index") }}'; // 将index url赋值给JavaScript变量

        // 实现特殊符号框起来的链接解析
        document.addEventListener('DOMContentLoaded', function() {
            const postContent = document.querySelector('.post-content');
            let content = postContent.innerHTML;
            // 简单的链接解析，查找 [[链接文字|URL]] 格式
            const linkRegex = /\[\[(.*?)\|(.*?)\]\]/g;
            content = content.replace(linkRegex, '<a href="$2" target="_blank" class="parsed-link">$1</a>');
            postContent.innerHTML = content;
        });

        // 管理员删除文章功能
        function deletePost(postId) {
            if (confirm('{{ text.confirm_delete_post }}')) {
                fetch('/admin/delete_post/' + postId, {
                    method: 'POST',
                })
                .then(response => {
                    if (response.ok) {
                        alert('{{ text.delete_success }}');
                        window.location.href = indexUrl;
                    } else {
                        alert('{{ text.delete_fail }}');
                    }
                })
                .catch(error => {
                    console.error('{{ text.delete_error }}:', error);
                    alert('{{ text.delete_error }}');
                });
            }
        }
    </script>
</body>
</html> 